<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />

    <meta name="description" content="">
    <meta name="author" content="Morgan Rehnberg">

    <title>Timeline Test</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="timeline.css">
    <style>

      @font-face {
        font-family: Gotham-Bold;
        src: url(../Gotham-Bold.otf);
      }
      @font-face {
        font-family: Gotham-Book;
        src: url(../Gotham-Book.otf);
      }
      @font-face {
        font-family: Gotham-Medium;
        src: url(../Gotham-Medium.otf);
      }
      @font-face {
        font-family: Gotham-Light;
        src: url(../Gotham-Light.otf);
      }

      body, html {
        margin: 0px;
        padding: 0px;
        /* cursor: none; */
      }
      H1 {
        font-family: Gotham-Medium;
        font-size: 75px;
      }
      p {
        outline-width: 5px;
        outline-style: dotted;
        outline-color: rgba(0,0,0,0);
        transition: all 1.5s;
      }
      ::-webkit-scrollbar {
        width: 0;
      }
      .btn-learn {
        font-size: 35px;
        font-family: Gotham-Light;
      }
      .caption-text {
        font-family: Gotham-Light;
        font-size: 35px;
      }
      .quote-body {
        font-family: Gotham-Medium;
        font-size: 80px;
      }
      .quote-name {
        font-family: Gotham-Light;
        font-size: 35px;
      }
      .timeline {
        margin-bottom: 100px;
      }
      #body-col {
        height: 85vh;
        overflow-y: scroll;
      }
      #body-text {
        font-size: 50px;
      }
      #content-pane {
        height: 85vh;
      }
      #fadeOutZone {
        opacity: 0;
      }
      #goHomeButton {
        font-size: 80px;
        font-family: Gotham-Bold;
      }
      #header {
        height: 10vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #header-text {
        font-size: 140px;
        font-family: Gotham-Bold;
      }
      #imageLightbox {
        position: absolute;
        height: 85vh;
        width: 100vw;
        top: 10vh;
        left: 0px;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        display: none;
        align-items: center;
        opacity: 0;
      }
      #imageLightboxCaption {
        font-size: 50px;
        background-color: rgba(0, 0, 0, 0.9);
      }
      #imageLightboxCredit {
        font-size: 35px;
        background-color: rgba(0, 0, 0, 0.9);
      }
      #imageLightboxImage {
        width: 100%;
        display: block;
        margin: auto;
      }
      #langToggleButton {
        font-size: 60px;
      }
      #sponsorDiv {
        color: white;
        font-family: Gotham-Light;
        font-size: 45px;
        display: flex;
        align-items: flex-end;
        justify-content: flex-end;
      }
      #timeline-col {
        height: 85vh;
        overflow-y: scroll;
        overflow-x:hidden;
      }
      #toolbar {
        height:5vh;
        font-family: Gotham-Medium;
      }
    </style>
  </head>


  <body>
    <main id='mainContainer' role="main" class="container-fluid px-0">

      <div id="imageLightbox" onclick="hideImageLightBox();">
        <div style='width: 100%;'>
          <div class='row'>
            <div class='offset-2 col-8 px-4 pt-4 pb-2' style="background-color: rgba(0,0,0,0.9)">
              <img id="imageLightboxImage">
              </img>
            </div>
            <div id='imageLightboxCaption' class='offset-2 col-8 px-4 px-2'>
            </div>
            <div id='imageLightboxCredit' class='offset-2 col-8 px-4 pb-4 pt-2'>
            </div>
          </div>
        </div>
      </div>

      <header id='header' class='bg-secondary sticky-top'>
        <div class="row">
          <div id='header-text' class="col-12 text-center text-white">
            Attack
          </div>
        </div>
      </header>

      <div id='fadeOutZone'>
        <div id='content-pane' class='row'>
          <!-- Left side: Timeline -->
          <div id="timeline-col" class="col-6 border-end border-white">
            <section class="timeline">
              <ul id="timeline-content"></ul>
            </section>
          </div>
          <!-- Right side: Story -->
          <div id='body-col' class="col-6 pe-4 pt-4 border-start border-white">
            <div id="body-text">
              <H1>Just another day</H1>
              <p id="paragraph1">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Vivamus arcu felis bibendum ut tristique et egestas quis. Tempus imperdiet nulla malesuada pellentesque elit. Tempor orci dapibus ultrices in iaculis nunc sed augue. Cursus vitae congue mauris rhoncus. Id ornare arcu odio ut sem. Neque sodales ut etiam sit amet nisl purus. Diam sit amet nisl suscipit adipiscing bibendum. Et malesuada fames ac turpis egestas sed tempus. At quis risus sed vulputate odio ut enim blandit volutpat. Convallis convallis tellus id interdum. Nam at lectus urna duis convallis convallis tellus.
              </p>
              <div class="card me-3 mt-2 mb-2 bg-secondary" style="width: 100%; float: left;">
                <div class="card-body">
                  <p class="quote-body card-text fst-italic">
                    Oh, my goodness. There's another one!
                  </p>
                </div>
                <div class="card-footer">
                  <p class="quote-name card-text">
                    WNYW reporter Jim Ryan, upon seeing the impact on the South Tower.
                  </p>
                </div>
              </div>
              <H1>One plane goes silent. And then another one.</H1>
              <p id="paragraph2">
                Elementum tempus egestas sed sed risus pretium. Posuere sollicitudin aliquam ultrices sagittis. Senectus et netus et malesuada fames ac turpis. Sit amet tellus cras adipiscing enim eu turpis egestas. Amet venenatis urna cursus eget nunc scelerisque viverra mauris. Ultrices neque ornare aenean euismod elementum. Vulputate enim nulla aliquet porttitor lacus luctus accumsan tortor. Nunc non blandit massa enim nec dui nunc mattis enim. Sit amet consectetur adipiscing elit ut aliquam purus sit amet.
              </p>
              <div class="card me-3 mt-2 mb-2 bg-transparent" style="width: 50%; float: right;">
                <div class="card-body">
                  <img src="thumbnails/WTC_collapse_CC_BY_Wally_Gobetz.jpg" width="100%" onclick="showImageInLightBox('WTC_collapse_CC_BY_Wally_Gobetz.jpg', 'A view of the World Trade Center complex shortly after the collapse of the North Tower.', 'Wally Gobetz')"></src>
                </div>
                <div class="card-footer">
                  <p class="caption-text card-text">
                    A view of the World Trade Center complex shortly after the collapse of the North Tower.
                  </p>
                </div>
              </div>
              <H1>No ordinary hijackings</H1>
              <p id="paragraph3">
                Amet purus gravida quis blandit turpis cursus in. Non tellus orci ac auctor augue mauris. Enim praesent elementum facilisis leo vel fringilla est ullamcorper. Sit amet mauris commodo quis imperdiet massa tincidunt nunc. Turpis egestas maecenas pharetra convallis posuere morbi leo urna. Pellentesque elit eget gravida cum sociis natoque. Nec dui nunc mattis enim. Turpis nunc eget lorem dolor. Vel quam elementum pulvinar etiam.
              </p>
            </div>
          </div>
        </div>

      </div>
      <footer id='toolbar' class='bg-secondary fixed-bottom'>
        <div class='row gx-1 h-100'>
          <div class='col-2'>
            <button id="langToggleButton" class='btn btn-primary w-100 h-100'>Espanol</button>
          </div>
          <div class='col-1'>
            <button class='btn btn-primary w-100 h-100'><font size="55px">A</font></button>
          </div>
          <div class='col-1'>
            <button class='btn btn-primary w-100 h-100'><font size="110px">A</font></button>
          </div>
          <div class='col-4'>
            <button id='goHomeButton' class='btn btn-lg w-100 h-100 btn-success' onclick="goHome()">Go Home</button>
          </div>
          <div id="sponsorDiv" class='col-4 pe-2 h-100'>
            <div>
              Generously sponsored by
              <br>
              <img src='../media/BankOfTexasLogo.png' width="100%"></src>
            </div>
          </div>
        </div>
      </footer>
    </main>
  </body>

  <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="content.js"></script>

  <script>


  function checkTimelineElementsInView() {

    var items = document.querySelectorAll(".timeline li");
    for (var i = 0; i < items.length; i++) {
      if (isElementInViewport(items[i])) {
        items[i].classList.add("in-view");
      } else {
        items[i].classList.remove("in-view");
      }
    }
  }

  function createTimeline() {

    // Read the timelineContentList and create a timeline element for each item

    timelineContentList.forEach((item, i) => {

      var newItem = document.createElement("li");
      var div = document.createElement("div");

      var time = document.createElement("time");
      time.className = `time-${item.rank}`;
      time.innerHTML = item["time_" + currentLang];
      div.appendChild(time);

      var title = document.createElement("p");
      title.className = `size-${item.rank}`;
      title.innerHTML = item["title_" + currentLang];
      div.appendChild(title);

      var body = document.createElement("p");
      body.className = "timeline-body";
      body.innerHTML = item["body_" + currentLang];
      div.append(body);

      if ("link" in item && item["link"] != "") {
        var button = document.createElement("button");
        button.className = "btn btn-outline-primary btn-learn";
        button.innerHTML = "Learn more";
        button.onclick = function() {
          console.log("here")
          goToParagraph(item["link"]);
        }
        div.append(button);
      }

      if ("image" in item && item["image"] != "") {
        var img = document.createElement("img");
        img.src = "thumbnails/" + item["image"];
        img.style.width = "100%";
        img.addEventListener("click", function() {
          showImageInLightBox(item["image"],
                              item["caption_" + currentLang],
                              item["credit"]);
        })

        div.appendChild(img);
      }

      newItem.appendChild(div);
      document.getElementById("timeline-content").appendChild(newItem);
    });
  }

    function goHome() {

      $("#fadeOutZone").animate({opacity: 0, queue: false}, 400, function(){window.location.href = '../911_kiosk.html';});
    }

    function goToParagraph(id) {

      // Scroll the text column to the given paragraph and outline it for
      // several seconds

      var para = $("#" + id);
      var col = $("#body-col");

      var fadeOutBorder = function() {
        para.css({"outline-color": ("rgba(0,0,0,0)")});
      };

      var fadeInBorder = function() {
        para.css({"outline-color": "yellow"});
        setTimeout(fadeOutBorder, 2000);
      };


      var scrollDuration = Math.abs(para.offset().top - col.offset().top - 100) + 500 // ms
      col.animate({scrollTop: para.offset().top - col.offset().top + col.scrollTop() - 100}, {complete: fadeInBorder, duration: scrollDuration});


    }

    function hideImageLightBox() {

      // Fade out the lightbox, and then hide it so it doesn't steal touches

      var temp = function() {$("#imageLightbox").css("display", "none");};
      $("#imageLightbox").animate({opacity: 0, queue: false}, {complete: temp, duration: 100});
    }

    // check if an element is in viewport
    // http://stackoverflow.com/questions/123999/how-to-tell-if-a-dom-element-is-visible-in-the-current-viewport
    function isElementInViewport(el) {
      var rect = el.getBoundingClientRect();
      return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <=
          (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
      );
    }

    function showImageInLightBox(image, caption="", credit="") {

      // Set the img source to the provided image, set the caption, and reveal
      // the light box. The desired image must be located in the media directory

      document.getElementById("imageLightboxImage").src = "media/" + image;
      document.getElementById("imageLightboxCaption").innerHTML = caption;
      if (credit != "" && credit != undefined) {
        document.getElementById("imageLightboxCredit").innerHTML = "Image credit: " + credit;
      } else {
        document.getElementById("imageLightboxCredit").innerHTML = "";
      }

      $("#imageLightbox").css("display", "flex").animate({opacity: 1, queue: false}, 100);
    }

    var currentLang = "en";

    // Populate timeline
    createTimeline();
    setInterval(checkTimelineElementsInView, 100);

    // When the page loads, fade in the content
    window.addEventListener("load", function(){$("#fadeOutZone").animate({opacity: 1})})

  </script>
</html>
