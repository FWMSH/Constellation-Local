<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />

    <meta name="description" content="">
    <meta name="author" content="Morgan Rehnberg">

    <title>9/11 Kiosk</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">

    <style>

      @font-face {
        font-family: Gotham-Bold;
        src: url(Gotham-Bold.otf);
      }
      @font-face {
        font-family: Gotham-Book;
        src: url(Gotham-Book.otf);
      }
      @font-face {
        font-family: Gotham-Medium;
        src: url(Gotham-Medium.otf);
      }
      @font-face {
        font-family: Gotham-Light;
        src: url(Gotham-Light.otf);
      }

      body, html {
        margin: 0px;
        padding: 0px;
        background: #719abf;
        /* cursor: none; */
      }
      ::-webkit-scrollbar {
        width: 0;
      }
      .hero-image {
        position: absolute;
        width: 100%;
        opacity: 0;
      }
      .icon {
        width: 20vw;
        align-items: flex-end;
        display: flex;
        border-style: solid;
        border-color: #719abf;
        border-width: 20px;
      }
      #content-pane {
        position: absolute;
        width: 80vw;
        height: 22vh;
        top: 50vh;
        left: 10vw;
        background-color: rgba(0,0,0, 0.6);
      }
      #description-text {
        height: 17vh;
        overflow: scroll;
        font-size: 50px;
      }
      #fadeOutZone {
        opacity: 0;
      }
      #header {
        height: 10vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #456990;
      }
      #header-text {
        font-size: 180px;
        color: white;
        width: 100vw;
        position: absolute;
        left: 0px;
        top: 110px;
        text-align: center;
        font-family: Gotham-Bold;
      }
      #icon-attack {
      }
      #icon-legacy {
      }
      #icon-prologue {
      }
      #icon-response {
      }
      #icon-row {
        position: absolute;
        top: 72vh;
        height: 20vh;
        width: 100vw;
      }
      #icon-military {
      }
      #langToggleButton {
        font-size: 60px;
      }
      #learn-more {
        font-size: 50px;
        font-family: Gotham-Medium;
        background-color: #719abf;
        color: white;
      }
      #sponsorDiv {
        color: white;
        font-family: Gotham-Light;
        font-size: 45px;
        display: flex;
        align-items: flex-end;
        justify-content: flex-end;
      }
      #super-header-text {
        font-size: 80px;
        color: white;
        width: 100vw;
        position: absolute;
        left: 0px;
        top: 35px;
        text-align: center;
        font-family: Gotham-Light;
      }
      #toolbar {
        height: 5vh;
        font-family: Gotham-Medium;
        background-color: #002f65;
      }
      #top-panel {
        width: 100vw;
        height: 70vh;
        font-family: Gotham-Book;
      }
    </style>
  </head>

  <body>
    <main id='mainContainer' role="main" class="container-fluid px-0">

      <div id="fadeOutZone">
        <header id='header' class='sticky-top'>
          <div id='super-header-text'>
          </div>
          <div id="header-text">
          </div>
        </header>


        <div id="top-panel">
          <img id="heroImage-prologue" class="hero-image" src="media/1_Looming_Crisis.jpeg" width="100%"></img>
          <img id="heroImage-attack" class="hero-image" src="media/2_Attack.jpeg" width="100%"></img>
          <img id="heroImage-response" class="hero-image" src="media/3_Reaction.jpeg" width="100%"></img>
          <img id="heroImage-military" class="hero-image" src="media/4_Military_Response.jpeg" width="100%"></img>
          <img id="heroImage-legacy" class="hero-image" src="media/5_Legacy.jpeg" width="100%"></img>


          <div id="content-pane" class="row mx-0 px-0">
            <div id="description-text" class="text-white col-12 mt-5 px-5">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
            </div>
            <div class='col-4 offset-4 text-center mt-1'>
              <button id='learn-more' class='btn btn-lg w-100' onclick="gotoPage()">Learn More</button>
            </div>
          </div>



        </div>

        <div id='icon-row' class='row mt-5 mx-0 align-items-end'>
          <div class='col px-0'>
            <div id="icon-prologue" class='icon mx-auto' onclick="selectTopic('icon-prologue')">
              <img src='thumbnails/1_Looming_Crisis.jpeg' width="100%"></img>
            </div>
          </div>
          <div class='col px-0'>
            <div id="icon-attack" class="icon mx-auto" onclick="selectTopic('icon-attack')">
              <img src='thumbnails/2_Attack.jpeg' width="100%"></img>
            </div>
          </div>
          <div class='col px-0'>
            <center>
              <div id="icon-response" class="icon mx-auto" onclick="selectTopic('icon-response')">
                <img src='thumbnails/3_Reaction.jpeg' width="100%"></img>
              </div>
            </center>
          </div>
          <div class='col px-0'>
            <div id="icon-military" class="icon mx-auto" onclick="selectTopic('icon-military')">
              <img src='thumbnails/4_Military_Response.jpeg' width="100%"></img>
            </div>
          </div>
          <div class='col px-0'>
            <div id="icon-legacy" class="icon mx-auto" onclick="selectTopic('icon-legacy')">
              <img src='thumbnails/5_Legacy.jpeg' width="100%"></img>
            </div>
          </div>
        </div>
      </div>
      <footer id='toolbar' class='row fixed-bottom align-items-end'>
        <div class='row gx-1 h-100'>
          <div class='col-2'>
            <button id="langToggleButton" class='btn btn-primary w-100 h-100' onclick="toggleLang();">Espanol</button>
          </div>
          <div class='col-1'>
            <!-- <button class='btn btn-primary w-100 h-100' onclick="fontSizeDecrease()"><font size="55px">A</font></button> -->
            <button class='btn btn-primary w-100 h-100' onclick="fontSizeDecrease()"><img src='media/text_size_down.png' width=100%></img></button>
          </div>
          <div class='col-1'>
            <!-- <button class='btn btn-primary w-100 h-100' onclick="fontSizeIncrease()"><font size="110px">A</font></button> -->
            <button class='btn btn-primary w-100 h-100' onclick="fontSizeIncrease()"><img src='media/text_size_up.png' width=100%></img></button>
          </div>
          <div id="sponsorDiv" class='offset-4 col-4 px-5 pb-4 h-100'>
            <div>
              Generously sponsored by
              <br>
              <img src='media/BankOfTexasLogo.png' width="100%"></src>
            </div>
          </div>
        </div>
      </footer>
    </main>
  </body>

  <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>

  <script type="text/javascript" src="content.js"></script>
  <script type="text/javascript" src="config.js"></script>

  <script>

    function attractor() {

      // firstStarted == true when the page is first loaded; we start the
      // attractor right away
      if (firstStarted) {
        currentIdleTime = idleTimeLimit + 1;
        firstStarted = false;
      }
      if (currentIdleTime > idleTimeLimit) {
        fontSizeReset();
        setLang("en");
        currentPosition += 1;
        if (currentPosition > 4) {
          currentPosition = 0;
        }
        selectTopic(attractorSequence[currentPosition]);
      } else {
        currentIdleTime += attractorIntervalTime;
      }
    }

    function fontSizeDecrease(animate=true) {

      var newSize = parseInt($("#description-text").css("fontSize").slice(0,-2)) - 3;
      if (newSize < 50) {
        newSize = 50;
      } else {
        fontTicks -= 1;
      }

      fontSizeSet(newSize, animate);
    }

    function fontSizeIncrease(animate=true) {

      var newSize = parseInt($("#description-text").css("fontSize").slice(0,-2)) + 3;
      if (newSize > 80) {
        newSize = 80;
      } else {
        fontTicks += 1;
      }

      fontSizeSet(newSize, animate);
    }

    function fontSizeReset() {

      fontTicks = 0;
      fontSizeSet(50);
      $("#description-text").animate({scrollTop: 0, queue: false});

    }

    function fontSizeSet(size, animate=true) {

      var duration;
      if (animate) {
        duration = 50;
      } else {
        duration = 0;
      }

      newHeight = contentPaneHeightDefault  + 30*fontTicks;
      newTop = contentPaneTopDefault - 30*fontTicks;
      newLeft = contentPaneLeftDefault -  5*fontTicks;
      newWidth = contentPaneWidthDefault +  10*fontTicks;
      newDescHeight = descriptionHeightDefault +  25*fontTicks;

      $("#learn-more").animate({fontSize: size, queue: false}, duration);
      $("#description-text").animate({fontSize: size, queue: false}, duration);
      $("#content-pane").animate({"height": newHeight, "left": newLeft, "top": newTop, "width": newWidth, queue: false}, duration);
      $("#description-text").animate({"height": newDescHeight, queue: false}, duration);
    }

    function gotoPage() {

      var page = "";

      switch (currentTopic) {
        // case 'prologue':
        //
        //   break;
        case 'attack':
          page = "2_attack/2_attack.html";
          break;
        // case 'response':
        //
        //   break;
        // case 'military':
        //
        //   break;
        // case 'legacy':
        //
        //   break;
        default:
          page = "2_attack/2_attack.html";
      }

      var link = page + `?lang=${currentLang}&size=${fontTicks}`
      $("#fadeOutZone").fadeOut(400, function(){window.location.href = link});
    }

    function localize() {

      // Make sure every content field has content for the appropriate language

      $("#super-header-text").html(superTitle_text[currentLang]);
      $("#header-text").html(title_text[currentLang]);
      $("#learn-more").html(learn_more_button_text[currentLang]);
      $("#langToggleButton").html(lang_toggle_text[currentLang]);
      setDescription(currentTopic);
    }

    function parseQueryString() {

      // Read the query string to determine what options to set

      var queryString = decodeURIComponent(window.location.search);

      var searchParams = new URLSearchParams(queryString);

      if (searchParams.has("attractor")) {
        firstStarted = true;
      } else {
        if (searchParams.has("lang")) {
          setLang(searchParams.get("lang"));
        }
        if (searchParams.has("size")) {
          var size = parseInt(searchParams.get("size"));
          fontTicks = size;
          fontSizeSet(50 + 3*size, false);
        }
      }
    }

    function selectTopic(id) {

      // Called when an icon is clicked

      var topic = id.split("-")[1]
      $(".icon").animate({width: "19vw"}, {duration:150, queue:false})
      $("#"+id).animate({width: "23vw"}, {duration:150, queue:false})

      $('.hero-image').not("#heroImage-"+topic).animate({opacity:0, queue:false});
      $("#heroImage-"+topic).animate({opacity: 1, queue:false})
      setDescription(topic);
    }

    function sendPing() {

      // Contact the control server and ask for any updates

      if (serverAddress != "") {

        var requestDict = {"class": "exhibitComponent",
                           "id": id,
                           "type": type,
                           "currentInteraction": "false"};
        var requestString = JSON.stringify(requestDict);

        var xhr = new XMLHttpRequest();
        xhr.timeout = 1000;
        xhr.open("POST", serverAddress, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onerror = function() {
        }
        xhr.onreadystatechange = function () {

          if (this.readyState != 4) return;

          if (this.status == 200) {
            if (this.responseText != "") {
              // readUpdate(this.responseText);
            }
          }
      };
        xhr.send(requestString);
      }
    }

    function setDescription(topic) {

        // Change the text in the description box
        currentTopic = topic;

        var textToSet = "";
        switch (topic) {
          case "prologue":
            textToSet = prologue_description[currentLang];
            currentPosition = 0;
            break;
          case "attack":
            textToSet = attack_description[currentLang];
            currentPosition = 1;
            break;
          case "response":
            textToSet = response_description[currentLang];
              currentPosition = 2;
            break;
          case "military":
            textToSet = military_description[currentLang];
            currentPosition = 3;
            currentTopic = topic;
            break;
          case "legacy":
            textToSet = legacy_description[currentLang];
            currentPosition = 4;
            currentTopic = topic;
            break;
          default:
            console.log("Error, unknown topic:", topic)
            return;
        }
      $("#description-text").html(textToSet);
    }

    function setLang(lang) {

      currentLang = lang;
      localize();
    }

    function toggleLang() {

      // Switch between English and Spanish, updating visible content.
      if (currentLang == "en") {
        currentLang = "es";
      } else {
        currentLang = "en";
      }
      localize();
    }

    // Attractor variables
    var attractorSequence = ["icon-prologue", "icon-attack", "icon-response", "icon-military", "icon-legacy"];
    var currentPosition = 0; // Index of where we are in the sequence
    var attractorIntervalReference = null; // Will hold a reference to the setInterval instance
    var attractorIntervalTime = 3; // Seconds between switches
    var idleTimeLimit = 30; // Seconds from last interaction until we show the attractor
    var currentIdleTime = 0;
    var firstStarted = false;

    // Layout defautls. Set to null now, will be filled when document loads
    contentPaneHeightDefault = null;
    contentPaneWidthDefault = null;
    contentPaneLeftDefault = null;
    contentPaneTopDefault = null;
    descriptionHeightDefault = null;

    var currentLang = "en";
    var currentTopic = "prologue";
    var fontTicks = 0; // 0 = default +1 for each increase, -1 for each decrease

    $(document).ready(function(){

      contentPaneHeightDefault = parseInt($("#content-pane").css("height").slice(0,-2));
      contentPaneWidthDefault = parseInt($("#content-pane").css("width").slice(0,-2));
      contentPaneTopDefault = parseInt($("#content-pane").css("top").slice(0,-2));
      contentPaneLeftDefault = parseInt($("#content-pane").css("left").slice(0,-2));
      descriptionHeightDefault = parseInt($("#description-text").css("height").slice(0,-2));
      parseQueryString();
      selectTopic("icon-prologue");
      $("#fadeOutZone").animate({opacity: 1, queue: false}, 400)


    });
    $(document).click(function(event){
      // Reset the attractor count if a click occurs
      currentIdleTime = 0;
    });
    document.addEventListener('touchstart', function(event) {
      // Reset the attractor count if a click occurs
      currentIdleTime = 0;
    });

    attractorIntervalReference = setInterval(attractor, attractorIntervalTime*1000);
    setInterval(sendPing, 5000);

  </script>

</html>
