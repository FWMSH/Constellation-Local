<!DOCTYPE html/javascript>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="masthead">
Changemakers
</div>

<!-- This overlay covers the whole screen with the video attractor -->
<div id="overlay" onclick="hideAttractor()">
    <video id='attractor' src='attractor.mp4' height=100% width=100% autoplay loop muted>
</div>

<!-- This holds the tabs with all their content -->
<div id="tabArea">
</div>
<!-- This holds the buttons for switching tabs -->
<div id='tabButtonContainer'>
</div>

<!-- This is the bottom row of buttons for changing settings -->
<button class="sizeButton sizeSmall" onclick="textSizeDown()">A</button><button class="sizeButton sizeLarge" onclick="textSizeUp()">A</button><button class="langSwitch" id="langSwitch" onclick="localize('swap')">Espanol</button>

<!-- Import the content specific to this InfoStation -->
<script src='content.js'></script>

<!-- Import the code for the various module types -->
<script src='videoTab.js'></script>
<script src='imageTab.js'></script>

<script src='analytics.js'></script>

<script>

/* Open a tab */
function openPage(pageName,elmnt,color) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablink");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].style.backgroundColor = "";
  }
  document.getElementById(pageName).style.display = "block";
  elmnt.style.backgroundColor = color;
  var bigVideo = document.getElementById("expandedVideo");
  bigVideo.pause();

  // Send action to analytics servers
  sendAnalytics(pageName, 'show');

}

/* Adjust the text size */

function setTextSize(val){

    textSize = val

    var elements = document.getElementsByClassName('bodyText');

    for (var i = 0; i < elements.length; i++) {
      var element = elements[i];
      element.style.fontSize = val + 'px'
    }

    var element = document.getElementById("imgCaptionText")
    element.style.fontSize = val + 'px'

    var element = document.getElementById("vidCaptionText")
    element.style.fontSize = val + 'px'
}

function textSizeDown(){

    setTextSize(textSize-4)
    sendHeartbeat(type=2) // Someone touched the button!
}

function textSizeUp(){

    setTextSize(textSize+4)
    sendHeartbeat(type=2) // Someone touched the button!
}


/* Show and hide the attractor overlay */
function showAttractor() {
  bigVideo = document.getElementById("expandedVideo")
  /* Only switch to attractor if we're not watching a video */
  if (bigVideo.paused){
      document.getElementById("attractor").play()
      document.getElementById("overlay").style.display = "block";
      setDefaults()

      // Send action to analytics servers
      sendAnalytics('attractor', 'show');
  }
}

function hideAttractor() {
  document.getElementById("attractor").pause();
  document.getElementById("overlay").style.display = "none";

  // Send action to analytics servers
  sendAnalytics('attractor', 'hide');
}

var inactivityTime = function () {
    var time;
    window.onload = resetTimer;
    // DOM Events
    bigVideo = document.getElementById("expandedVideo")
    bigVideo.onended = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeypress = resetTimer;
    function resetTimer() {
            clearTimeout(time);
            time = setTimeout(showAttractor, 30000)
            // 1000 milliseconds = 1 second
        }
}

function localize(lang){

    switch (lang){
        case "en":
            curLang = "en";
            break;
        case "es":
            curLang = "es";
            break;
        case "swap":
            if (curLang == "en"){
                curLang = "es";
                lang = "es";
            } else {
                curLang = "en";
                lang = "en";
            }
            break;
    }

    // Loop the elements with text and switch them.
    var ids = ['buttonStory', 'buttonImages', 'buttonVideo', 'buttonArtifacts', 'langSwitch', 'masthead', 'story', 'artifacts']
    for (var i = 0; i < ids.length; i++) {
        id = document.getElementById(ids[i]);
        id.innerHTML = textDict[ids[i]+'_'+lang];
    }

    // Loop captions separately, since we are setting the alt text
    ids = ['image1', 'image2', 'image3', 'image4', 'image5', 'image6', 'image7', 'image8', 'video1', 'video2', 'video3', 'video4']
    for (var i = 0; i < ids.length; i++) {
        id = document.getElementById(ids[i]);
        id.alt = textDict[ids[i]+'Caption_'+lang];
    }

    // Make sure evrything is at the correct text size
    setTextSize(textSize)

    // Clear the caption since the language doesn't change
    var vidText = document.getElementById("vidCaptionText");
    vidText.innerHTML = ""
    var imgText = document.getElementById("imgCaptionText");
    imgText.innerHTML = ""

}

function setDefaults(){

    // Set the starting page
    //document.getElementById("buttonImages").click();
    document.getElementById("buttonVideo").click();

    // Populate the text fieldset
    //localize('en');

    // Reset text size
    setTextSize(25)

    // Clear the caption since the language might be switched.
    var vidText = document.getElementById("vidCaptionText");
    vidText.innerHTML = ""
    var imgText = document.getElementById("imgCaptionText");
    imgText.innerHTML = ""
}

// Hold the current language
var curLang = 'en';

// Hold the current text size
var textSize = 25;

// Build the tabs
buildImageTab(imageContent);
buildVideoTab(videoContent);

// Start the timer checking for idle (30 s)
inactivityTime();

// Start the heartbeat timer
heartbeatTimer();

// Set the default state
setDefaults();

</script>

</body>
</html>













<!--  -->
